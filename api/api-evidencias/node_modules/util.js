var fs = require('fs');
var http = require('http');
var util = require('util.js');

exports.log = function (text) {
	fs.appendFile('log.txt', text + "\r\n", function(erro) {
		if(erro) console.log(erro);
	});
}

exports.setResponse = function (res) {
	res.setHeader('Access-Control-Allow-Origin', '*');
	res.setHeader('Access-Control-Request-Method', '*');
	res.setHeader('Access-Control-Allow-Methods', 'OPTIONS, GET');
	res.setHeader('Access-Control-Allow-Headers', '*');
	return res;
}

exports.requestWithData = function (data, host, port, path, method, callback) {
	var options = {
	    host: host,
	  	port: port,
	    path: path,
	    method: method,
	    headers: {
			'Content-Type': 'application/json; charset=utf-8',
			'Content-Length': Buffer.byteLength(data)
	    }
  	};

  	var httpreq = http.request(options, function (response) {
  		var json;
  		var status = response.statusCode;
	    response.setEncoding('utf8');
	    response.on('data', function (chunk) {
      		json = chunk;
	    });
	    response.on('end', function() {
	    	callback(json, status);
	    })
  	});

  	httpreq.on('error', (e) => {
  		util.log("problem with request: " + e.message);
	});
  	httpreq.write(data, 'utf8');
	httpreq.end();
}
